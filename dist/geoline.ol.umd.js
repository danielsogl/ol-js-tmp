!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).openLayersReworked={})}(this,function(e){e.stma_openlayers=function(){var e=null,t=null,n=null,o=null,r=null,i=function(){return null==o&&$.ajax({method:"POST",url:"https://gis5.stuttgart.de/geoline/geoline.config/config.aspx",data:{v:"@version@",epsg:e,url:location.href},dataType:"json",async:!1,cache:!1,success:function(e){e.ags_hosts=$.map(e.ags_services,function(e){return e.ags_host}),o=e},error:function(e,t){console.error("OHOH",e,t)}}),o},s=function(n,o,r,s){$.ajax({url:n+"?f=json",type:"POST",dataType:"jsonp",success:function(c){try{if(void 0!==c.error)return void console.warn("Eigenschaften des Kartendienstes "+n+" konnten nicht abgerufen werden.",c.error);var u=new URL(n);if(jQuery.inArray(u.hostname,i().ags_hosts)>-1&&(null!=c.copyrightText&&0!=c.copyrightText.length||(c.copyrightText="© Stadtmessungsamt, LHS Stuttgart")),u.hostname.indexOf("arcgisonline.com")>-1||u.hostname.indexOf("arcgis.com")>-1){var d=$.grep(t.getControls().getArray(),function(e,t){return ol.control.Attribution.prototype.isPrototypeOf(e)})[0];d.setCollapsible(!1),d.setCollapsed(!1)}if(10.05==c.currentVersion&&null==c.spatialReference.latestWkid)switch(c.spatialReference.wkid){case 102100:c.spatialReference.latestWkid=3857}e!="EPSG:"+c.spatialReference.wkid&&e!="EPSG:"+c.spatialReference.latestWkid&&console.warn("Projektion der Karte und des Kartendienstes stimmen nicht überein. Karte: "+e+", Kartendienst: EPSG:",c.spatialReference.wkid+" / EPSG:"+c.spatialReference.latestWkid,n),1==c.singleFusedMapCache?a(n,o,r,c,s):l(n,o,r,c,s)}catch(e){console.error("Fehler beim Initalisieren des Layers "+n,e)}},error:function(e,t){console.error("OHOH",e,t)}})},a=function(e,o,s,a,l){var c=[];$.each(a.tileInfo.lods,function(e,t){c.push(t.resolution)});var u,d=new ol.tilegrid.TileGrid({origin:[a.tileInfo.origin.x,a.tileInfo.origin.y],extent:[a.fullExtent.xmin,a.fullExtent.ymin,a.fullExtent.xmax,a.fullExtent.ymax],minZoom:0,resolutions:c,tileSize:[a.tileInfo.rows,a.tileInfo.cols]});t.getView().getProjection().getCode()!=u&&($.extend(!0,n,{resolutions:c}),t.setView(new ol.View(n))),u=null!=a.spatialReference.latestWkid?a.spatialReference.latestWkid:a.spatialReference.wkid;var f={minZoom:"0"},g={tileGrid:d,projection:ol.proj.get("EPSG:"+u),attributions:a.copyrightText,url:e+"/tile/{z}/{y}/{x}"};null!=r&&(g.tileLoadFunction=r),$.extend(!0,f,s,g);var p=10,y=new URL(e);jQuery.inArray(y.hostname,i().ags_hosts)>-1&&(p=20);var h={zIndex:p},m={source:new ol.source.XYZ(f)};$.extend(!0,h,o,m);var w=new ol.layer.Tile(h);t.addLayer(w),"function"==typeof l&&l(w)},l=function(e,n,o,r,s){var a={params:{layers:"show:0"}},l={ratio:1,url:e,attributions:[new ol.Attribution({html:r.copyrightText})]};$.extend(!0,a,o,l);var c=40,u=new URL(e);jQuery.inArray(u.hostname,i().ags_hosts)>-1&&(c=50);var d={zIndex:c},f={source:new ol.source.ImageArcGISRest(a)};$.extend(!0,d,n,f);var g=new ol.layer.Image(d);t.addLayer(g),"function"==typeof s&&s(g)};this.initMap=function(i,s,a,l){ol.proj.addProjection(new ol.proj.Projection({code:"EPSG:25832",units:"m"})),ol.proj.addProjection(new ol.proj.Projection({code:"EPSG:31467",units:"m"})),e="EPSG:"+i,null==ol.proj.get(e)&&console.error("Projektion "+e+" nicht gefunden. Es kann zu falscher Darstellung der Karte kommen"),null!=l&&null!=l.tileLoadFunction&&(r=l.tileLoadFunction),null!=l&&null!=l.config&&(console.warn("Konfiguration wurde manuell gesetzt und wird nicht vom Server des Stadtmessungamtes geladen. Bitte stellen Sie sicher, dass die Konfiguration immer aktuell ist."),o=l.config);var c={target:"map",controls:ol.control.defaults({attribution:!0,attributionOptions:{tipLabel:"Copyright"}})};if($.extend(!0,c,s,{logo:!1,pixelRatio:1,loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0}),null!=c.controls){var u=!1;c.controls.forEach(function(e,t){ol.control.Attribution.prototype.isPrototypeOf(e)&&(u=!0)}),0==u&&c.controls.push(new ol.control.Attribution({tipLabel:"Copyright"}))}n=$.extend(!0,{},{center:[513785,5402232],zoom:2},a,{projection:ol.proj.get(e)}),t=new ol.Map(c),$(".ol-viewport").on("contextmenu",function(e){e.preventDefault()}),t.updateSize()},this.addEsriLayer=function(e,t,n,o){var r=new URL(e);jQuery.inArray(r.hostname,i().ags_hosts)>-1?console.error("Kartendienste des Stadtmessungsamtes über die Methode addStmaEsriLayer hinzufügen"):s(e,t,n,o)},this.addStmaEsriLayer=function(e,t,n,o){s("https://"+i().ags_host+"/"+i().ags_instance+"/rest/services/"+e+"/MapServer",t,n,o)},this.addStmaBaseLayer=function(e,t,n,o){null!=i().ags_services[e]?s("https://"+i().ags_services[e].ags_host+"/"+i().ags_services[e].ags_instance+"/rest/services/"+i().ags_services[e].ags_service+"/MapServer",t,n,o):console.error("Karte '"+e+"' nicht gefunden")},this.addPoints=function(e,n,o){for(var r=[],i=0;i<e.length;i++)r.push(new ol.Feature({geometry:new ol.geom.Point(e[i])}));var s=new ol.layer.Vector({zIndex:60,source:new ol.source.Vector({features:r}),style:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:n})})});t.addLayer(s),"function"==typeof o&&o(s)},this.addStmaEsriFeatureLayer=function(n,o,r,s){var a=e.replace("EPSG:","");console.warn("_epsgCode: "+a);var l=new ol.format.EsriJSON,c=new ol.source.Vector({loader:function(e,t,r){var s="https://"+i().ags_host+"/"+i().ags_instance+"/rest/services/"+n+"/MapServer/"+o+"/query/",u={f:"json",returnGeometry:!0,spatialRel:"esriSpatialRelIntersects",geometry:encodeURIComponent('{"xmin":'+e[0]+',"ymin":'+e[1]+',"xmax":'+e[2]+',"ymax":'+e[3]+',"spatialReference":{"wkid":'+a+"}}"),geometryType:"esriGeometryEnvelope",inSR:a,outFields:"*",outSR:a};$.ajax({method:"POST",url:s,data:u,dataType:"jsonp",success:function(e){if(e.error)alert(e.error.message+"\n"+e.error.details.join("\n"));else{var t=l.readFeatures(e,{featureProjection:r});t.length>0&&c.addFeatures(t)}}})},strategy:ol.loadingstrategy.tile(ol.tilegrid.createXYZ({tileSize:512}))}),u=new ol.layer.Vector({zIndex:60,source:c,style:r});t.addLayer(u),"function"==typeof s&&s(u)},this.getMap=function(){return t},this.getConfig=function(){return i()}}});
//# sourceMappingURL=geoline.ol.umd.js.map
